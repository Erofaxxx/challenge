# –†–µ—à–µ–Ω–∏–µ Mamba-2 –¥–ª—è Wunder Fund RNN Challenge

## üìã –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

–≠—Ç–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã **Mamba-2** (Selective State Space Model) –¥–ª—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—é –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Mamba-2**
   - Selective State Space Model (SSM) –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
   - 4 —Å–ª–æ—è Mamba-2 –±–ª–æ–∫–æ–≤ —Å residual connections
   - Convolutional layers –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - Gating mechanisms –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞

2. **Feature Engineering**
   - –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (raw features)
   - Delta –ø—Ä–∏–∑–Ω–∞–∫–∏ (–ø–µ—Ä–≤–∞—è —Ä–∞–∑–Ω–æ—Å—Ç—å)
   - Acceleration (–≤—Ç–æ—Ä–∞—è —Ä–∞–∑–Ω–æ—Å—Ç—å)
   - Moving averages (–æ–∫–Ω–∞: 3, 5, 10, 20)
   - Standard deviations (–æ–∫–Ω–∞: 5, 10, 20)
   - Exponential Moving Averages (decay: 0.1, 0.3, 0.5)
   - **–ò—Ç–æ–≥–æ: 13x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**

3. **Per-Sequence –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**
   - –ö–∞–∂–¥–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
   - Running mean –∏ variance (Welford's method)
   - –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

4. **–ê–Ω—Å–∞–º–±–ª—å –º–æ–¥–µ–ª–µ–π**
   - 3 –º–æ–¥–µ–ª–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ random seeds
   - –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ —Ä–µ—Å—É—Ä—Å—ã**
   - CPU-only —Ä–µ–∂–∏–º
   - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
   - Context length = 80 —à–∞–≥–æ–≤
   - d_model = 128 (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –º–æ–¥–µ–ª—å)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd mamba_solution
pip install -r requirements.txt
```

**–¢—Ä–µ–±—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
- PyTorch >= 2.0.0
- NumPy >= 1.24.0
- Pandas >= 2.0.0
- scikit-learn >= 1.3.0
- tqdm >= 4.65.0
- pyarrow >= 12.0.0

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
mamba_solution/
‚îú‚îÄ‚îÄ solution.py          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å –º–æ–¥–µ–ª—å—é (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –¥–ª—è submission)
‚îú‚îÄ‚îÄ train.py            # –°–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md          # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îî‚îÄ‚îÄ mamba_model_*.pt   # –û–±—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ (—Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è)
```

---

## üìö –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

#### –ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
python train.py --data ../datasets/train.parquet
```

–≠—Ç–æ –æ–±—É—á–∏—Ç **3 –º–æ–¥–µ–ª–∏** —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- d_model: 128
- n_layers: 4
- batch_size: 64
- epochs: 15
- learning_rate: 0.0005
- context_length: 80

#### –û–±—É—á–µ–Ω–∏–µ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```bash
python train.py \
    --data ../datasets/train.parquet \
    --num-models 3 \
    --d-model 128 \
    --n-layers 4 \
    --batch-size 64 \
    --epochs 15 \
    --lr 0.0005 \
    --context-length 80
```

#### –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
python train.py \
    --data ../datasets/train.parquet \
    --num-models 1 \
    --epochs 5 \
    --batch-size 32
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--data`: –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –¥–∞–Ω–Ω—ã–º–∏ (train.parquet)
- `--num-models`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π –≤ –∞–Ω—Å–∞–º–±–ª–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3)
- `--d-model`: —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 128)
- `--n-layers`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Mamba —Å–ª–æ–µ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 4)
- `--batch-size`: —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 64)
- `--epochs`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 15)
- `--lr`: learning rate (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.0005)
- `--context-length`: –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —à–∞–≥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 80)

**–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è:**
- 1 –º–æ–¥–µ–ª—å, 15 —ç–ø–æ—Ö: ~30-60 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç CPU)
- 3 –º–æ–¥–µ–ª–∏, 15 —ç–ø–æ—Ö: ~1.5-3 —á–∞—Å–∞

**–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ—è–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã:
- `mamba_model_0.pt`
- `mamba_model_1.pt`
- `mamba_model_2.pt`

---

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

#### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
python solution.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. –ó–∞–≥—Ä—É–∑–∏—Ç –æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
2. –ü—Ä–æ–≥–æ–Ω–∏—Ç —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ `train.parquet`
3. –í—ã—á–∏—Å–ª–∏—Ç R¬≤ score –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞
4. –ü–æ–∫–∞–∂–µ—Ç —Å—Ä–µ–¥–Ω–∏–π R¬≤ score

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ó–∞–≥—Ä—É–∂–∞–µ–º 3 –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π...
  –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –º–æ–¥–µ–ª—å: mamba_model_0.pt
  –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –º–æ–¥–µ–ª—å: mamba_model_1.pt
  –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –º–æ–¥–µ–ª—å: mamba_model_2.pt

–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ ../datasets/train.parquet...
–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: 32
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: 500000

–û—Ü–µ–Ω–∏–≤–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ...
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 500000/500000 [XX:XX<00:00, XXX.XXit/s]

============================================================
–†–ï–ó–£–õ–¨–¢–ê–¢–´
============================================================
–°—Ä–µ–¥–Ω–∏–π R¬≤ –ø–æ –≤—Å–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º: 0.XXXXXX

R¬≤ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 5 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:
  0: 0.XXXXXX
  1: 0.XXXXXX
  2: 0.XXXXXX
  3: 0.XXXXXX
  4: 0.XXXXXX

–í—Å–µ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: 32
============================================================
–†–µ—à–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ!
============================================================
```

**–¶–µ–ª–µ–≤–æ–π R¬≤ score: ‚â• 0.39**

---

### –°–æ–∑–¥–∞–Ω–∏–µ submission —Ñ–∞–π–ª–∞

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–±

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `prepare_submission.sh`:

```bash
#!/bin/bash
# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p submission_temp

# –ö–æ–ø–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã
cp solution.py submission_temp/
cp mamba_model_*.pt submission_temp/ 2>/dev/null || echo "–ù–µ—Ç –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π"
cp requirements.txt submission_temp/

# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤
cd submission_temp
zip -r ../submission.zip .
cd ..

# –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
rm -rf submission_temp

echo "–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª submission.zip"
echo "–†–∞–∑–º–µ—Ä:"
ls -lh submission.zip
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
chmod +x prepare_submission.sh
./prepare_submission.sh
```

#### –†—É—á–Ω–æ–π —Å–ø–æ—Å–æ–±

```bash
# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤ —Å solution.py –∏ –≤–µ—Å–∞–º–∏ –º–æ–¥–µ–ª–µ–π
zip submission.zip solution.py mamba_model_*.pt

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
unzip -l submission.zip
```

**–í–∞–∂–Ω–æ:**
- `solution.py` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∫–æ—Ä–Ω–µ –∞—Ä—Ö–∏–≤–∞
- –§–∞–π–ª—ã `mamba_model_*.pt` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ—Ä–Ω–µ –∞—Ä—Ö–∏–≤–∞
- –ê—Ä—Ö–∏–≤ –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è `submission.zip` –∏–ª–∏ `solution.zip`

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏

```
Input (base_dim=32)
    ‚Üì
Feature Engineering (13x expansion)
    ‚Üì
Per-Sequence Normalization
    ‚Üì
Input Projection (engineered_dim ‚Üí d_model=128)
    ‚Üì
Layer Norm
    ‚Üì
Mamba Block 1 (SSM + Conv + Gating)
    ‚Üì
Mamba Block 2
    ‚Üì
Mamba Block 3
    ‚Üì
Mamba Block 4
    ‚Üì
Layer Norm
    ‚Üì
Output Projection (d_model ‚Üí base_dim=32)
    ‚Üì
Prediction
```

### Mamba-2 Block

```
Input
    ‚Üì
Input Projection (x, z) ‚Üê –¥–≤–æ–π–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è
    ‚Üì
Conv1D (–ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç) ‚Üí x
    ‚Üì
SiLU activation
    ‚Üì
State Space Transform (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π SSM)
    ‚Üì
Gating (x * z)
    ‚Üì
Output Projection
    ‚Üì
Residual Connection + Layer Norm
    ‚Üì
Output
```

### Feature Engineering –¥–µ—Ç–∞–ª–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è **13x** –±–æ–ª—å—à–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:

1. **Raw features** (1x): –∏—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
2. **Delta** (1x): `state[t] - state[t-1]`
3. **Acceleration** (1x): `delta[t] - delta[t-1]`
4. **Moving Averages** (4x): –æ–∫–Ω–∞ [3, 5, 10, 20]
5. **Standard Deviations** (3x): –æ–∫–Ω–∞ [5, 10, 20]
6. **Exponential MAs** (3x): decay [0.1, 0.3, 0.5]

**–ü—Ä–∏–º–µ—Ä:**
- base_dim = 32
- engineered_dim = 32 √ó 13 = 416

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

**Per-Sequence Normalization** —Å running statistics:

```python
# –î–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
mean = 0
var = 1
count = 0

# –ü—Ä–∏ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
count += 1
delta = x - mean
mean += delta / count
delta2 = x - mean
var += (delta * delta2 - var) / count

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
x_normalized = (x - mean) / sqrt(var + epsilon)
```

**–í–∞–∂–Ω–æ:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ `seq_ix`!

---

## üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
seq_ix | step_in_seq | need_prediction | 0 | 1 | ... | 31
-------|-------------|-----------------|---|---|-----|----
   0   |      0      |       0         | x | x | ... | x
   0   |      1      |       0         | x | x | ... | x
  ...  |     ...     |      ...        |...|...|     |...
   0   |     99      |       0         | x | x | ... | x  ‚Üê warm-up –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
   0   |     100     |       1         | x | x | ... | x  ‚Üê scored predictions –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è
  ...  |     ...     |      ...        |...|...|     |...
   0   |     999     |       1         | x | x | ... | x
   1   |      0      |       0         | x | x | ... | x  ‚Üê –Ω–æ–≤–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!
```

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –∫–∞–∂–¥–∞—è `seq_ix` –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞
2. **–°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ø—Ä–∏ —Å–º–µ–Ω–µ `seq_ix` —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –í–°–Å (feature engineer, normalizer, context)
3. **Warm-up –ø–µ—Ä–∏–æ–¥**: —à–∞–≥–∏ 0-99 (need_prediction=0) - –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
4. **Scored predictions**: —à–∞–≥–∏ 100-999 (need_prediction=1) - –¥–µ–ª–∞–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
5. **–í—Å–µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π**: 900 –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –∫–∞–∂–¥–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
1. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ 1000 —à–∞–≥–æ–≤ (feature engineering + normalization)
2. –°–æ–∑–¥–∞–µ–º –æ–±—É—á–∞—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã:
   - `i=99`: –∫–æ–Ω—Ç–µ–∫—Å—Ç [0...99] ‚Üí –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —à–∞–≥ 100
   - `i=100`: –∫–æ–Ω—Ç–µ–∫—Å—Ç [21...100] ‚Üí –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —à–∞–≥ 101
   - ...
   - `i=998`: –∫–æ–Ω—Ç–µ–∫—Å—Ç [919...998] ‚Üí –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —à–∞–≥ 999
3. –í—Å–µ–≥–æ: **900 –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤** –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Memory Management

```python
# –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
del seq_data, states
gc.collect()

# –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏
if epoch % 5 == 0:
    gc.collect()
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

#### –°–µ—Ä–≤–µ—Ä —Å 16GB RAM, 8 CPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
python train.py \
    --num-models 3 \
    --d-model 128 \
    --n-layers 4 \
    --batch-size 64 \
    --epochs 15
```

#### –°–µ—Ä–≤–µ—Ä —Å 8GB RAM, 4 CPU

```bash
python train.py \
    --num-models 2 \
    --d-model 96 \
    --n-layers 4 \
    --batch-size 32 \
    --epochs 12
```

#### –ù–æ—É—Ç–±—É–∫ (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

```bash
python train.py \
    --num-models 1 \
    --d-model 64 \
    --n-layers 3 \
    --batch-size 16 \
    --epochs 10
```

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **Baseline (Moving Average)**: R¬≤ ‚âà 0.15-0.20
- **LSTM**: R¬≤ ‚âà 0.25-0.35
- **Mamba-2 (–Ω–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ)**: R¬≤ ‚âà **0.39-0.45**

### –ß—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π –≤ –∞–Ω—Å–∞–º–±–ª–µ**: –±–æ–ª—å—à–µ ‚Üí –ª—É—á—à–µ (–Ω–æ –¥–æ–ª—å—à–µ)
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö**: 15-20 –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
3. **d_model**: 128-192 –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
4. **Context length**: 80-100 —à–∞–≥–æ–≤
5. **Feature engineering**: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: Out of Memory

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ `--batch-size` –¥–æ 32 –∏–ª–∏ 16
- –£–º–µ–Ω—å—à–∏—Ç–µ `--d-model` –¥–æ 96 –∏–ª–∏ 64
- –£–º–µ–Ω—å—à–∏—Ç–µ `--context-length` –¥–æ 60

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–∏–π R¬≤ score

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±—É—á–∏—Ç–µ –±–æ–ª—å—à–µ –º–æ–¥–µ–ª–µ–π (`--num-models 5`)
- –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö (`--epochs 20`)
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ learning rates (`--lr 0.0003` –∏–ª–∏ `--lr 0.001`)

### –ü—Ä–æ–±–ª–µ–º–∞: –î–æ–ª–≥–æ–µ –æ–±—É—á–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π (`--num-models 1`)
- –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö (`--epochs 10`)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥–µ–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª—ã `mamba_model_*.pt` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á—Ç–æ –∏ `solution.py`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —É—Å–ø–µ—à–Ω–æ
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `train.py` –∑–∞–Ω–æ–≤–æ

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

- ‚úÖ –û–±—É—á–µ–Ω—ã 3 –º–æ–¥–µ–ª–∏ (`mamba_model_0.pt`, `mamba_model_1.pt`, `mamba_model_2.pt`)
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ (`python solution.py`)
- ‚úÖ R¬≤ score ‚â• 0.39
- ‚úÖ `solution.py` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –∞—Ä—Ö–∏–≤–∞
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –≤–µ—Å–æ–≤ –≤–∫–ª—é—á–µ–Ω—ã –≤ –∞—Ä—Ö–∏–≤
- ‚úÖ –ê—Ä—Ö–∏–≤ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `submission.zip`
- ‚úÖ –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞ —Ä–∞–∑—É–º–Ω—ã–π (–æ–±—ã—á–Ω–æ < 50MB)

---

## üèÜ –°–æ–≤–µ—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

1. **–£–≤–µ–ª–∏—á—å—Ç–µ –∞–Ω—Å–∞–º–±–ª—å**: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ 5-7 –º–æ–¥–µ–ª–µ–π
2. **Experiment —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π**: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ 5-6 —Å–ª–æ–µ–≤
3. **Feature engineering**: –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (percentiles, ratios)
4. **Data augmentation**: –¥–æ–±–∞–≤—å—Ç–µ —à—É–º –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏
5. **Learning rate scheduling**: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
6. **Regularization**: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ dropout rates

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º" –≤—ã—à–µ
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –¥–ª—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è Wunder Fund RNN Challenge.

---

**–£–¥–∞—á–∏ –≤ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏! üöÄ**
